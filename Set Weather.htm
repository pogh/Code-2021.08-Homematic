<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" type="text/css" href="./druckansicht.css">
</head>

<body><br>
  <div id="printDiv">
    <table id="ProgramTable" class="filterTable tTable j_translate" style="display: table;" cellspacing="0"
      cellpadding="0" border="0">
      <thead>
        <tr>
          <td class="thCell CLASS04802">Name</td>
          <td class="thCell CLASS04802">Description</td>
          <td class="thCell CLASS04802">Condition (if...)</td>
          <td class="thCell CLASS04802">Activity (then..., or else...)</td>
          <td class="thCell CLASS04802">Action</td>
        </tr>
      </thead>
      <tbody>
        <tr class="CLASS04803">
          <td class="tBodyCell bgWhite taCenter" id="prg5943name">Set Weather
          </td>
          <td class="tBodyCell bgWhite taCenter" id="prg5943desc">
          </td>
          <td class="tBodyCell">Time: Recurring All-day starting at 27.12.2025 trigger at point of time</td>
          <td class="tBodyCell">System status: Log Message immediately to Set Weather set</td>
          <td class="tBodyCell bgWhite"><input type="checkbox" onchange="isePrograms.SetVisibility(5943,this.checked);"
              id="p5943_systeminternal"><label for="p5943_systeminternal">intrinsic</label></td>
        </tr>
        <tr>
          <td colspan="5">
            <div id="prgrulecontent">
              <div id="rule5944" class="conditionEven">
                <div class="Rule j_translate" style="display: block;">
                  <div class="CLASS02300">Condition: If...</div>
                  <div class="Condition">
                    <div><span id="sico5952"><b><u>Time control</u><b></b></b> <br>
                        <pre>    <b><u>Zeit:</u></b> Zeitbereich ganztägig<br>    <b><u>Serienmuster:</u></b> Zeitintervall, alle 1 Stunden<br>    <b><u>Gültigkeitsdauer:</u></b> Beginn: 27.12.2025, kein Enddatum</pre>
                        <br> &nbsp;<b><u>trigger at point of time</u><b></b></b>
                      </span> </div><span></span><span></span>
                  </div>
                  <div><span><b><u>OR</u><b></b></b></span></div>
                </div>
                <div class="Rule">
                  <div class="CLASS02300">Activity: Then...<label><input type="checkbox" checked="checked" class="SelectBox">Stop all
                      current delays before performing the activity (e.g. retriggering).</label></div>
                  <div><span id="side5954"><b><u>System state</u><b></b></b> <b class="CLASS02400">Log Message</b> <b><u>immediately</u><b></b></b>
                      <b><u>Set Weather</u></b>
                    </span> </div>
                  <div><span id="side5955"><b><u>Script</u><b></b></b> <br>
                      <pre>!----------------------------------------------------------------------------- !<br>!Icons<br><br>!10 = Sonne<br>!11 = Mond<br>!12 = Wind<br>!13 = Wolke<br>!14 = Wolke / Blitz<br>!15 = Wolke / leichter Regen<br>!16 = Wolke / Mond<br>!17 = Wolke / Regen<br>!18 = Wolke / Schnee<br>!19 = Wolke / Sonne<br>!20 = Wolke / Sonne / Regen<br>!21 = Wolke / Schneeflocke<br>!22 = Wolke / Regentropfen<br><br>!----------------------------------------------------------------------------- !<br>!WebService<br><br>string stdout;<br>string stderr;<br>string url = "https://api.open-meteo.com/v1/forecast?latitude=52.52&amp;longitude=13.41&amp;forecast_hours=12&amp;hourly=temperature_2m,dew_point_2m,weather_code&amp;timezone=Europe%2FBerlin";<br><br>system.Exec("wget -q --no-check-certificate -O - '" # url # "' ", &amp; stdout, &amp; stderr);<br><br>!----------------------------------------------------------------------------- !<br><br>real realValue;<br>integer integerValue;<br><br>string values;<br>string tagName;<br>integer tagNameLength;<br>string tagValue;<br><br>integer hours_ahead_count = 12; !Same as in URL<br>integer hour = system.Date("%H").ToInteger();<br>boolean is_night = true;<br><br>real temp_min = 99.9;<br>real temp_max = 00.0;<br><br>string temp_min_str;<br>string temp_max_str;<br><br>real first_temp = 99.9;<br>integer temp_rising_count = 0;<br>integer temp_falling_count = 0;<br>boolean weather_temp_rising = true;<br><br>real temp_dew_point = 00.0;<br><br>integer weather_code = -1;<br>string icon;<br><br>!------------------------------------------------------------------------------!<br><br>if (stdout.Length() &gt; 0) {<br><br>    !--------------------------------------------------------------------------!<br>    !Min, Max Temps<br><br>    integer i = 0;<br>    tagName = "temperature_2m";<br>    tagNameLength = tagName.Length();<br><br>    values = stdout;<br>    values = values.Substr(values.Find("\"" + tagName + "\":") + tagNameLength + 3);<br>    values = values.Substr(values.Find("\"" + tagName + "\":") + tagNameLength + 4);<br><br>    while (i &lt; hours_ahead_count) {<br>        i = i + 1;<br><br>        tagValue = values.Substr(0, values.Find(","));<br>        values = values.Substr(tagValue.Length() + 1);<br><br>        !WriteLine(i # " temperature_2m: " # tagValue);<br><br>        realValue = tagValue.ToFloat();<br><br>        if (realValue &lt; temp_min) {<br>            temp_min = realValue;<br>        }<br><br>        if (realValue &gt; temp_max) {<br>            temp_max = realValue;<br>        }<br><br>        if (first_temp == 99.9) {<br>            first_temp = realValue;<br>        }<br>        else {<br>            if (realValue &gt; first_temp) {<br>                temp_rising_count = temp_rising_count + 1;<br>            }<br>            else {<br>                temp_falling_count = temp_falling_count + 1;<br>            }<br>        }<br>    }<br><br>    !WriteLine(temp_rising_count);<br>    !WriteLine(temp_falling_count);<br><br>    if (temp_rising_count &gt; temp_falling_count) {<br>        weather_temp_rising = true;<br>    }<br>    else {<br>        weather_temp_rising = false;<br>    }<br><br>    !WriteLine(temp_min);<br>    !WriteLine(temp_max);<br>    !WriteLine(weather_temp_rising);<br><br>    !--------------------------------------------------------------------------!<br>    !Dew Point Temperature<br><br>    integer i = 0;<br>    tagName = "dew_point_2m";<br>    tagNameLength = tagName.Length();<br><br>    values = stdout;<br>    values = values.Substr(values.Find("\"" + tagName + "\":") + tagNameLength + 3);<br>    values = values.Substr(values.Find("\"" + tagName + "\":") + tagNameLength + 4);<br><br>    while (i &lt; hours_ahead_count) {<br>        i = i + 1;<br><br>        tagValue = values.Substr(0, values.Find(","));<br>        values = values.Substr(tagValue.Length() + 1);<br><br>        !WriteLine(i # " dew_point_2m: " # tagValue);<br><br>        realValue = tagValue.ToFloat();<br><br>        if (realValue &gt; temp_dew_point) {<br>            temp_dew_point = realValue;<br>        }<br>    }<br><br>    !WriteLine(temp_dew_point);<br><br>    !--------------------------------------------------------------------------!<br>    !Weather Icon<br><br>    integer i = 0;<br>    tagName = "weather_code";<br>    tagNameLength = tagName.Length();<br><br>    values = stdout;<br>    values = values.Substr(values.Find("\"" + tagName + "\":") + tagNameLength + 3);<br>    values = values.Substr(values.Find("\"" + tagName + "\":") + tagNameLength + 4);<br><br>    while (i &lt; hours_ahead_count) {<br>        i = i + 1;<br><br>        tagValue = values.Substr(0, values.Find(","));<br>        values = values.Substr(tagValue.Length() + 1);<br><br>        !WriteLine(i # " weather_code: " # tagValue);<br><br>        integerValue = tagValue.ToInteger();<br><br>        if (integerValue &gt; weather_code) {<br>            weather_code = integerValue;<br>        }<br>    }<br><br>    !WriteLine(weather_code);<br><br>    if ((hour &lt; 4) || (hour &gt; 16)) {<br>        is_night = true;<br>    }<br>    else {<br>        is_night = false;<br>    }<br><br>    icon = "05";<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !0  Clear sky<br>    if (weather_code == 0) {<br>        if (!is_night) {<br>            icon = "10"; !Sonne<br>        }<br>        else {<br>            icon = "11"; !Mond<br>        }<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !1, 2, 3  Mainly clear, partly cloudy, and overcast<br>    if (weather_code == 1) {<br>        if (!is_night) {<br>            icon = "10"; !Sonne<br>        }<br>        else {<br>            icon = "11"; !Mond<br>        }<br>    }<br>    if (weather_code == 2) {<br>        if (!is_night) {<br>            icon = "19"; !Wolke / Sonne<br>        }<br>        else {<br>            icon = "16"; !Wolke / Mond<br>        }<br>    }<br>    if (weather_code == 3) {<br>        if (!is_night) {<br>            icon = "19"; !Wolke / Sonne<br>        }<br>        else {<br>            icon = "16"; !Wolke / Mond<br>        }<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !45, 48  Fog and depositing rime fog<br>    if (weather_code == 45) {<br>        icon = "13"; !Wolke<br>    }<br>    if (weather_code == 48) {<br>        icon = "13"; !Wolke<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !51, 53, 55  Drizzle: Light, moderate, and dense intensity<br>    if (weather_code == 51) {<br>        icon = "15"; !Wolke / leichter Regen<br>    }<br>    if (weather_code == 53) {<br>        icon = "17"; !Wolke / Regen<br>    }<br>    if (weather_code == 55) {<br>        icon = "17"; !Wolke / Regen<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !56, 57  Freezing Drizzle: Light and dense intensity<br>    if (weather_code == 56) {<br>        icon = "15"; !Wolke / leichter Regen<br>    }<br>    if (weather_code == 57) {<br>        icon = "17"; !Wolke / Regen<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !61, 63, 65  Rain: Slight, moderate and heavy intensity<br>    if (weather_code == 61) {<br>        icon = "15"; !Wolke / leichter Regen<br>    }<br>    if (weather_code == 63) {<br>        icon = "17"; !Wolke / Regen<br>    }<br>    if (weather_code == 65) {<br>        icon = "17"; !Wolke / Regen<br>    }<br><br>    !66, 67  Freezing Rain: Light and heavy intensity<br>    if (weather_code == 66) {<br>        icon = "15"; !Wolke / leichter Regen<br>    }<br>    if (weather_code == 67) {<br>        icon = "17"; !Wolke / Regen<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !71, 73, 75  Snow fall: Slight, moderate, and heavy intensity<br>    if (weather_code == 71) {<br>        icon = "18"; !Wolke / Schnee<br>    }<br>    if (weather_code == 73) {<br>        icon = "18"; !Wolke / Schnee<br>    }<br>    if (weather_code == 75) {<br>        icon = "18"; !Wolke / Schnee<br>    }<br><br>    !77  Snow grains<br>    if (weather_code == 77) {<br>        icon = "18"; !Wolke / Schnee<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !80, 81, 82  Rain showers: Slight, moderate, and violent<br>    if (weather_code == 80) {<br>        icon = "20"; !Wolke / Sonne / Regen<br>    }<br>    if (weather_code == 81) {<br>        icon = "20"; !Wolke / Sonne / Regen<br>    }<br>    if (weather_code == 82) {<br>        icon = "20"; !Wolke / Sonne / Regen<br>    }<br><br>    !85, 86  Snow showers slight and heavy<br>    if (weather_code == 85) {<br>        icon = "21"; !Wolke / Schneeflocke<br>    }<br>    if (weather_code == 86) {<br>        icon = "21"; !Wolke / Schneeflocke<br>    }<br><br>    ! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - !<br>        !95 * Thunderstorm: Slight or moderate<br>    if (weather_code == 95) {<br>        icon = "14"; !Wolke / Blitz;<br>    }<br><br>    !96, 99 * Thunderstorm with slight and heavy hail<br>    if (weather_code == 96) {<br>        icon = "14"; !Wolke / Blitz;<br>    }<br>    if (weather_code == 99) {<br>        icon = "14"; !Wolke / Blitz;<br>    }<br><br>    !----------------------------------------------------------------------------- !<br>    <br>    temp_min = temp_min.Round(1);<br><br>    temp_min_str = temp_min.ToString();<br>    temp_min_str = temp_min_str.Substr(0, temp_min_str.Find(".") + 2);<br><br>    if (temp_min_str == "-0") {<br>        temp_min_str = "0";<br>    }<br><br>    temp_min_str = temp_min_str + dom.GetObject("Degree Symbol").Value() + "C"; !Find() + 0 ==&gt; Homematic Bug<br><br>    dom.GetObject("WeatherTempMin").State(temp_min_str);<br><br>    !----------------------------------------------------------------------------- !<br><br>    temp_max = temp_max.Round(1);<br><br>    temp_max_str = temp_max.ToString();<br>    temp_max_str = temp_max_str.Substr(0, temp_max_str.Find(".") + 2);<br><br>    if (temp_max_str == "-0") {<br>        temp_max_str = "0";<br>    }<br><br>    temp_max_str = temp_max_str + dom.GetObject("Degree Symbol").Value() + "C"; !Find() + 0 ==&gt; Homematic Bug<br><br>    dom.GetObject("WeatherTempMax").State(temp_max_str);<br><br>    !----------------------------------------------------------------------------- !<br><br>    dom.GetObject("WeatherTempRising").State(weather_temp_rising);<br>    dom.GetObject("WeatherTempDewPoint").State(temp_dew_point);<br>    dom.GetObject("WeatherIcon").State(icon);<br><br>    dom.GetObject("IsStatusDisplayNeedsUpdate").State(true);<br><br>    !----------------------------------------------------------------------------- !<br>    !Debug<br><br>    WriteLine("Min: " # dom.GetObject("WeatherTempMin").Value());<br>    WriteLine("Max: " # dom.GetObject("WeatherTempMax").Value());<br>    WriteLine("WeatherTempRising: " # dom.GetObject("WeatherTempRising").Value());<br>    WriteLine("Dew Point: " # dom.GetObject("WeatherTempDewPoint").Value());<br>    WriteLine("Icon: " # dom.GetObject("WeatherIcon").Value());<br>}</pre>
                      <br> <b><u>immediately</u><b></b></b>
                    </span> </div><span></span>
                </div>
                <div class="Rule">
                  <div class="CLASS02300">Activity:<b><u>Else...</u><b></b></b><label><input type="checkbox" class="SelectBox">Stop all
                      current delays before performing the activity (e.g. retriggering).</label></div><span></span>
                </div>
              </div>

            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div><br>
</body>

</html>